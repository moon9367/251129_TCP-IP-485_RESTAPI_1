<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ìŠ¤ë§ˆíŠ¸íŒœ ë°ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="pages.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="api-config.js"></script>
    <script src="api-client.js"></script>
    <script src="data-manager.js"></script>
    <script src="chart-manager.js"></script>
    
    <!-- ì§ì ‘ ì„¼ì„œ ë°ì´í„° ë¡œë”© (ë°±ì—…) -->
    <script>
      //const API_SERVER = 'http://192.168.0.14:8000';
      const API_SERVER = 'https://normally-roman-jaguar-reflects.trycloudflare.com';  // Cloudflare Tunnel
      // const API_SERVER = 'http://192.168.0.14:8000';  // ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ (ì£¼ì„ì²˜ë¦¬)
      let autoRefreshTimer = null;
      
      // ì„¼ì„œ ë°ì´í„° ë¡œë“œ ë° UI ì—…ë°ì´íŠ¸
      async function loadAndUpdateSensors() {
        try {
          const response = await fetch(`${API_SERVER}/api/sensors/all`);
          const data = await response.json();
          
          if (data.success && data.sensors) {
            const sensors = data.sensors;
            
            // ì„¼ì„œ ê°œìˆ˜ ë° ì˜¤ë¥˜ ì¹´ìš´íŠ¸ (10ê°œ ì„¼ì„œ í™•ì¸)
            let totalSensors = 0;
            let errorCount = 0;
            
            const sensorList = [
              sensors.indoor_current_temperature,
              sensors.indoor_current_humidity,
              sensors.indoor_current_solar_radiation,
              sensors.indoor_current_moisture,
              sensors.indoor_current_soil_tension,
              sensors.outdoor_current_temperature,
              sensors.outdoor_current_humidity,
              sensors.outdoor_solar_radiation,
              sensors.outdoor_current_evaporation,
              sensors.outdoor_current_evaporation_rate
            ];
            
            sensorList.forEach(sensor => {
              if (sensor) {
                totalSensors++;
                // ê°’ì´ nullì´ê±°ë‚˜ undefinedì´ê±°ë‚˜ NaNì´ë©´ ì˜¤ë¥˜ë¡œ ì¹´ìš´íŠ¸
                if (sensor.value === null || sensor.value === undefined || isNaN(sensor.value)) {
                  errorCount++;
                }
              }
            });
            
            // ì„¼ì„œ ê°œìˆ˜ ë° ì˜¤ë¥˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            const sensorCountEl = document.getElementById('sensor-count');
            const sensorErrorsEl = document.getElementById('sensor-errors');
            if (sensorCountEl) sensorCountEl.textContent = totalSensors;
            if (sensorErrorsEl) sensorErrorsEl.textContent = errorCount;
            
            // ë‚´ë¶€ ì„¼ì„œ ì—…ë°ì´íŠ¸
            updateSensorValue('indoor_temp', sensors.indoor_current_temperature?.value, 'â„ƒ');
            updateSensorValue('indoor_humidity', sensors.indoor_current_humidity?.value, '%');
            updateSensorValue('indoor_solar', sensors.indoor_current_solar_radiation?.value, ' W/ã¡');
            updateSensorValue('indoor_moisture', sensors.indoor_current_moisture?.value, '%');
            updateSensorValue('indoor_soil_tension', sensors.indoor_current_soil_tension?.value, ' kPa');
            
            // ì™¸ë¶€ ì„¼ì„œ ì—…ë°ì´íŠ¸
            updateSensorValue('outdoor_temp', sensors.outdoor_current_temperature?.value, 'â„ƒ');
            updateSensorValue('outdoor_humidity', sensors.outdoor_current_humidity?.value, '%');
            updateSensorValue('outdoor_solar', sensors.outdoor_solar_radiation?.value, ' W/ã¡');
            
            console.log(`âœ… ì„¼ì„œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ! (${totalSensors}ê°œ ì„¼ì„œ, ${errorCount}ê±´ ì˜¤ë¥˜)`);
          }
        } catch (error) {
          console.error('âŒ ì„¼ì„œ ë¡œë“œ ì‹¤íŒ¨:', error);
        }
        
        // ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ (IOë³´ë“œ í†µì‹  ì²´í¬)
        try {
          // REGISTER_READ íƒ€ì…ì´ë¯€ë¡œ /api/status/ ì‚¬ìš©
          const statusResponse = await fetch(`${API_SERVER}/api/status/io_board_communication_check`);
          const statusData = await statusResponse.json();
          
          console.log('ğŸ” ì‹œìŠ¤í…œ ìƒíƒœ ì‘ë‹µ:', statusData);
          
          if (statusData.success && statusData.value !== undefined && statusData.value !== null) {
            const systemStatusEl = document.getElementById('system-status');
            if (systemStatusEl) {
              // 100 = ì—°ê²° ëŠê¹€, ê·¸ ì™¸ = ì •ìƒ
              if (statusData.value === 100) {
                systemStatusEl.textContent = 'âš ï¸ ì—°ê²° ëŠê¹€';
                systemStatusEl.style.color = 'var(--red)';
                console.log('âš ï¸ ì‹œìŠ¤í…œ ìƒíƒœ: ì—°ê²° ëŠê¹€ (ê°’: 100)');
              } else {
                systemStatusEl.textContent = 'âœ… ì •ìƒ';
                systemStatusEl.style.color = 'var(--green)';
                console.log(`âœ… ì‹œìŠ¤í…œ ìƒíƒœ: ì •ìƒ (ê°’: ${statusData.value})`);
              }
            }
          } else {
            console.warn('âš ï¸ ì‹œìŠ¤í…œ ìƒíƒœ ë°ì´í„° ì—†ìŒ:', statusData);
          }
        } catch (error) {
          console.error('âŒ ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
        }
      }
      
      // ì‹¤ì‹œê°„ ë‚ ì§œ ì—…ë°ì´íŠ¸
      function updateCurrentDate() {
        const now = new Date();
        const days = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
        const year = now.getFullYear();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        const dayOfWeek = days[now.getDay()];
        
        const dateStr = `${year}ë…„ ${month}ì›” ${date}ì¼ ${dayOfWeek}`;
        const dateEl = document.getElementById('current-date-info');
        if (dateEl) {
          dateEl.innerHTML = `${dateStr} Â· ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ Â· ë‚˜ì£¼ ëŒ€ì‹¤ë§ˆì„ ì˜¨ì‹¤ Aë™`;
        }
      }
      
      // ë‚˜ì£¼ì‹œ ë‚ ì”¨ ì •ë³´ ë¡œë“œ
      async function loadWeatherInfo() {
        try {
          console.log('ğŸŒ¤ ë‚ ì”¨ ì •ë³´ ë¡œë“œ ì‹œì‘...');
          const weatherURL = `${API_SERVER}/api/weather/naju`;
          console.log('ğŸ“¡ ë‚ ì”¨ API URL:', weatherURL);
          
          const response = await fetch(weatherURL);
          console.log('ğŸ“¥ ë‚ ì”¨ API ì‘ë‹µ ìƒíƒœ:', response.status);
          
          const data = await response.json();
          console.log('ğŸ“¦ ë‚ ì”¨ API ì‘ë‹µ ë°ì´í„°:', data);
          
          if (data.success) {
            // ë‚ ì”¨ ìƒíƒœ ì—…ë°ì´íŠ¸
            const weatherStatusEl = document.getElementById('weather-status');
            const feelsLikeTempEl = document.getElementById('feels-like-temp');
            
            if (weatherStatusEl) {
              weatherStatusEl.textContent = `${data.weather_icon} ${data.weather_text.replace('ë‚˜ì£¼ì‹œ ', '')}`;
              console.log('âœ… ë‚ ì”¨ ìƒíƒœ ì—…ë°ì´íŠ¸:', weatherStatusEl.textContent);
            }
            if (feelsLikeTempEl) {
              feelsLikeTempEl.textContent = data.temperature;
              console.log('âœ… ì˜¨ë„ ì—…ë°ì´íŠ¸:', data.temperature);
            }
            
            console.log(`âœ… ë‚ ì”¨ ì •ë³´ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${data.summary}`);
          } else {
            console.warn('âš ï¸ ë‚ ì”¨ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', data);
            console.warn('ğŸ’¡ ê°€ëŠ¥í•œ ì›ì¸: ê¸°ìƒì²­ API í‚¤ ë¯¸ìŠ¹ì¸ ë˜ëŠ” ì˜¤ë¥˜');
            console.warn('ğŸ’¡ í™•ì¸: https://www.data.go.kr/iim/api/selectAPIAcountView.do');
          }
        } catch (error) {
          console.error('âŒ ë‚ ì”¨ ì •ë³´ ë¡œë“œ ì˜¤ë¥˜:', error);
          console.error('âŒ ì˜¤ë¥˜ ìƒì„¸:', error.message);
        }
      }
      
      // ì„¼ì„œ ê°’ ì—…ë°ì´íŠ¸ í—¬í¼ í•¨ìˆ˜
      function updateSensorValue(sensorKey, value, unit) {
        const card = document.querySelector(`[data-sensor="${sensorKey}"]`);
        if (!card) return;
        
        const valueEl = card.querySelector('.value');
        if (valueEl && value !== null && value !== undefined && !isNaN(value)) {
          valueEl.textContent = `${value}${unit}`;
        }
      }
      
      // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹œì‘
      window.addEventListener('DOMContentLoaded', () => {
        console.log('ğŸš€ ì„¼ì„œ ë°ì´í„° ë¡œë”© ì‹œì‘!');
        
        // ì‹¤ì‹œê°„ ë‚ ì§œ ì—…ë°ì´íŠ¸
        updateCurrentDate();
        
        // ë‚ ì”¨ ì •ë³´ ë¡œë“œ
        loadWeatherInfo();
        
        // ì¦‰ì‹œ í•œ ë²ˆ ë¡œë“œ
        loadAndUpdateSensors();
        
        // 10ì´ˆë§ˆë‹¤ ì„¼ì„œ ë°ì´í„° ìë™ ìƒˆë¡œê³ ì¹¨
        autoRefreshTimer = setInterval(loadAndUpdateSensors, 10000);
        
        // 15ë¶„ë§ˆë‹¤ ë‚ ì”¨ ì •ë³´ ìë™ ìƒˆë¡œê³ ì¹¨ (API í˜¸ì¶œ ì œí•œ ëŒ€ì‘)
        setInterval(loadWeatherInfo, 900000);
        
        console.log('âœ… ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œì‘ (ì„¼ì„œ: 10ì´ˆ, ë‚ ì”¨: 15ë¶„)');
      });
      
      // ğŸ›ï¸ ë²”ìš© ì œì–´ í† ê¸€ í•¨ìˆ˜ (ë‚œë°©, ìœ ë™íŒ¬, ì œìŠµê¸°, LEDì¡°ëª…, ê´€ìˆ˜)
      async function toggleControl(toggleEl, deviceName) {
        const card = toggleEl.closest('.control-card');
        const isCurrentlyOff = toggleEl.classList.contains('off');
        const chipEl = card.querySelector('.chip');
        const statusEl = card.querySelector('.status-text');
        const titleSpan = card.querySelector('.title span');
        
        const autoMode = toggleEl.getAttribute('data-auto');
        const forcedMode = toggleEl.getAttribute('data-forced');
        
        // ì¥ì¹˜ë³„ ì•„ì´ì½˜ ì„¤ì •
        const icons = {
          'ë‚œë°©': 'ğŸ”¥',
          'ìœ ë™íŒ¬': 'ğŸŒ€',
          'ì œìŠµê¸°': 'ğŸ’¨',
          'LEDì¡°ëª…': 'ğŸ’¡',
          'ê´€ìˆ˜': 'ğŸš°'
        };
        const icon = icons[deviceName] || 'âš™ï¸';
        
        try {
          if (isCurrentlyOff) {
            // í† ê¸€ ON: ìë™ â†’ ìˆ˜ë™ ê°•ì œìš´ì „
            console.log(`${icon} ${deviceName}: ìë™ â†’ ìˆ˜ë™ ê°•ì œìš´ì „`);
            
            // 1. ì˜¤í† ëª¨ë“œ OFF
            const autoResult = await fetch(`${API_SERVER}/api/settings/${autoMode}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ value: 0 })
            });
            
            // 2. ê°•ì œìš´ì „ ON
            const forcedResult = await fetch(`${API_SERVER}/api/settings/${forcedMode}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ value: 1 })
            });
            
            if (autoResult.ok && forcedResult.ok) {
              // UI ì—…ë°ì´íŠ¸
              toggleEl.classList.remove('off');
              toggleEl.classList.add('on');
              toggleEl.setAttribute('data-mode', 'ìˆ˜ë™');
              chipEl.textContent = 'ìˆ˜ë™ ê°•ì œ';
              chipEl.classList.remove('auto');
              chipEl.classList.add('manual');
              statusEl.textContent = 'ON';
              statusEl.style.color = '#4ecca3';
              titleSpan.textContent = 'ê°•ì œ ìš´ì „ ì¤‘';
              
              console.log(`âœ… ${deviceName} ìˆ˜ë™ ëª¨ë“œ í™œì„±í™”`);
            } else {
              alert(`âŒ ${deviceName} ì œì–´ ì‹¤íŒ¨!`);
            }
            
          } else {
            // í† ê¸€ OFF: ìˆ˜ë™ â†’ ìë™
            console.log(`${icon} ${deviceName}: ìˆ˜ë™ â†’ ìë™`);
            
            // 1. ê°•ì œìš´ì „ OFF
            const forcedResult = await fetch(`${API_SERVER}/api/settings/${forcedMode}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ value: 0 })
            });
            
            // 2. ì˜¤í† ëª¨ë“œ ON
            const autoResult = await fetch(`${API_SERVER}/api/settings/${autoMode}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ value: 1 })
            });
            
            if (autoResult.ok && forcedResult.ok) {
              // UI ì—…ë°ì´íŠ¸
              toggleEl.classList.remove('on');
              toggleEl.classList.add('off');
              toggleEl.setAttribute('data-mode', 'ìë™');
              chipEl.textContent = 'ìë™';
              chipEl.classList.remove('manual');
              chipEl.classList.add('auto');
              statusEl.textContent = 'OFF';
              statusEl.style.color = '#6c757d';
              titleSpan.textContent = 'ìë™ ì œì–´';
              
              console.log(`âœ… ${deviceName} ìë™ ëª¨ë“œ í™œì„±í™”`);
            } else {
              alert(`âŒ ${deviceName} ì œì–´ ì‹¤íŒ¨!`);
            }
          }
        } catch (error) {
          console.error(`âŒ ${deviceName} ì œì–´ ì—ëŸ¬:`, error);
          alert(`âŒ ${deviceName} ì œì–´ ì‹¤íŒ¨: ${error.message}`);
        }
      }
      
      // ğŸš° ê´€ìˆ˜ í† ê¸€ ì œì–´ (í•˜ìœ„ í˜¸í™˜ì„±)
      function toggleIrrigation(toggleEl) {
        return toggleControl(toggleEl, 'ê´€ìˆ˜');
      }
      
      // ğŸªŸ ì²œì°½/ì»¤íŠ¼ ì œì–´ (ì—´ê¸°/ë‹«ê¸°/ì¤‘ë‹¨/ì „í™˜)
      // ì „ì—­ ë³€ìˆ˜: ê° ì²œì°½/ì»¤íŠ¼ì˜ íƒ€ì´ë¨¸ì™€ ì·¨ì†Œ í”Œë˜ê·¸ ì €ì¥
      const skylightTimers = {
        'ì¢Œì¸¡': { intervalId: null, timeoutId: null, cancelFlag: false },
        'ìš°ì¸¡': { intervalId: null, timeoutId: null, cancelFlag: false },
        'ì²œì¥ë³´ì˜¨': { intervalId: null, timeoutId: null, cancelFlag: false },
        'ì¸¡ë©´ë³´ì˜¨': { intervalId: null, timeoutId: null, cancelFlag: false },
        'ì°¨ê´‘': { intervalId: null, timeoutId: null, cancelFlag: false }
      };
      
      async function operateSkylight(btnEl, side, action) {
        const card = btnEl.closest('.control-card');
        const statusEl = card.querySelector('.skylight-status');
        const chipEl = card.querySelector('.chip');
        const allBtns = card.querySelectorAll('.skylight-btn');
        const footer = card.querySelector('footer');
        
        const autoMode = btnEl.getAttribute('data-auto');
        const openMode = btnEl.getAttribute('data-open');
        const closeMode = btnEl.getAttribute('data-close');
        
        const currentAction = card.getAttribute('data-current-action');
        
        // ğŸ›‘ í˜„ì¬ ì‘ë™ ì¤‘ì´ë©´ ì¤‘ë‹¨ ì²˜ë¦¬
        if (currentAction && currentAction !== '') {
          console.log(`â¸ï¸ ì²œì°½ ${side}: í˜„ì¬ ì‘ë™(${currentAction}) ì¤‘ë‹¨ ì¤‘...`);
          
          // íƒ€ì´ë¨¸ ì·¨ì†Œ
          if (skylightTimers[side].intervalId) {
            clearInterval(skylightTimers[side].intervalId);
            skylightTimers[side].intervalId = null;
          }
          if (skylightTimers[side].timeoutId) {
            clearTimeout(skylightTimers[side].timeoutId);
            skylightTimers[side].timeoutId = null;
          }
          skylightTimers[side].cancelFlag = true;
          
          // í˜„ì¬ ëª¨ë“œ OFF
          const currentMode = currentAction === 'open' ? openMode : closeMode;
          await fetch(`${API_SERVER}/api/settings/${currentMode}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ value: 0 })
          });
          
          console.log(`âœ… ì²œì°½ ${side}: ${currentAction} ëª¨ë“œ ì¤‘ë‹¨ ì™„ë£Œ`);
        }
        
        // ğŸš€ ìƒˆ ì‘ë™ ì‹œì‘
        card.setAttribute('data-current-action', action);
        skylightTimers[side].cancelFlag = false;
        
        const isOpen = action === 'open';
        const actionMode = isOpen ? openMode : closeMode;
        const icon = isOpen ? 'ğŸ”¼' : 'ğŸ”½';
        const actionText = isOpen ? 'ì—´ê¸°' : 'ë‹«ê¸°';
        
        try {
          console.log(`${icon} ì²œì°½ ${side}: ${actionText} ì‹œì‘`);
          
          // 1ï¸âƒ£ ì˜¤í† ëª¨ë“œ OFF
          await fetch(`${API_SERVER}/api/settings/${autoMode}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ value: 0 })
          });
          
          // 2ï¸âƒ£ ì‘ë™ ëª¨ë“œ ON (ì—´ê¸° ë˜ëŠ” ë‹«ê¸°)
          await fetch(`${API_SERVER}/api/settings/${actionMode}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ value: 1 })
          });
          
          // UI ì—…ë°ì´íŠ¸
          statusEl.textContent = `${icon} ${actionText} ì¤‘...`;
          chipEl.textContent = 'ìˆ˜ë™';
          chipEl.classList.remove('auto');
          chipEl.classList.add('manual');
          
          // ë²„íŠ¼ì„ "ì¤‘ë‹¨" ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
          footer.innerHTML = `
            <button class="skylight-btn stop-btn" 
                    data-auto="${autoMode}"
                    data-open="${openMode}"
                    data-close="${closeMode}"
                    onclick="stopSkylight(this, '${side}')" 
                    style="flex: 1; padding: 8px; border: 1px solid #ffa500; background: transparent; color: #ffa500; border-radius: 4px; cursor: pointer; font-size: 14px;">
              â¸ï¸ ì¤‘ë‹¨
            </button>
            <button class="skylight-btn ${isOpen ? 'close-btn' : 'open-btn'}" 
                    data-auto="${autoMode}"
                    data-open="${openMode}"
                    data-close="${closeMode}"
                    onclick="operateSkylight(this, '${side}', '${isOpen ? 'close' : 'open'}')" 
                    style="flex: 1; padding: 8px; border: 1px solid ${isOpen ? '#ff6b6b' : '#4ecca3'}; background: transparent; color: ${isOpen ? '#ff6b6b' : '#4ecca3'}; border-radius: 4px; cursor: pointer; font-size: 14px;">
              ${isOpen ? 'ğŸ”½ ë‹«ê¸°' : 'ğŸ”¼ ì—´ê¸°'}
            </button>
          `;
          
          // 3ï¸âƒ£ 3ë¶„ (180ì´ˆ) ëŒ€ê¸° â†’ ì¹´ìš´íŠ¸ë‹¤ìš´ í‘œì‹œ
          let remainingSeconds = 180;
          skylightTimers[side].intervalId = setInterval(() => {
            if (skylightTimers[side].cancelFlag) {
              clearInterval(skylightTimers[side].intervalId);
              return;
            }
            
            const minutes = Math.floor(remainingSeconds / 60);
            const seconds = remainingSeconds % 60;
            statusEl.textContent = `${icon} ${actionText} ì¤‘... ${minutes}:${seconds.toString().padStart(2, '0')}`;
            remainingSeconds--;
            
            if (remainingSeconds < 0) {
              clearInterval(skylightTimers[side].intervalId);
            }
          }, 1000);
          
          // 3ë¶„ ëŒ€ê¸°
          await new Promise((resolve, reject) => {
            skylightTimers[side].timeoutId = setTimeout(() => {
              if (skylightTimers[side].cancelFlag) {
                reject(new Error('Cancelled'));
              } else {
                resolve();
              }
            }, 180000); // 3ë¶„ = 180000ms
          });
          
          if (skylightTimers[side].cancelFlag) {
            throw new Error('Operation cancelled');
          }
          
          clearInterval(skylightTimers[side].intervalId);
          console.log(`â° ì²œì°½ ${side}: 3ë¶„ ê²½ê³¼ â†’ ìë™ ëª¨ë“œ ì „í™˜`);
          
          // 4ï¸âƒ£ ì‘ë™ ëª¨ë“œ OFF
          await fetch(`${API_SERVER}/api/settings/${actionMode}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ value: 0 })
          });
          
          // 5ï¸âƒ£ ì˜¤í† ëª¨ë“œ ON
          await fetch(`${API_SERVER}/api/settings/${autoMode}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ value: 1 })
          });
          
          // UI ì—…ë°ì´íŠ¸: ìë™ ì œì–´
          statusEl.textContent = 'ìë™ ì œì–´';
          chipEl.textContent = 'ìë™';
          chipEl.classList.remove('manual');
          chipEl.classList.add('auto');
          
          // ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
          footer.innerHTML = `
            <button class="skylight-btn open-btn" 
                    data-auto="${autoMode}"
                    data-open="${openMode}"
                    data-close="${closeMode}"
                    onclick="operateSkylight(this, '${side}', 'open')" 
                    style="flex: 1; padding: 8px; border: 1px solid #4ecca3; background: transparent; color: #4ecca3; border-radius: 4px; cursor: pointer; font-size: 14px;">
              ğŸ”¼ ì—´ê¸°
            </button>
            <button class="skylight-btn close-btn" 
                    data-auto="${autoMode}"
                    data-open="${openMode}"
                    data-close="${closeMode}"
                    onclick="operateSkylight(this, '${side}', 'close')" 
                    style="flex: 1; padding: 8px; border: 1px solid #ff6b6b; background: transparent; color: #ff6b6b; border-radius: 4px; cursor: pointer; font-size: 14px;">
              ğŸ”½ ë‹«ê¸°
            </button>
          `;
          
          card.setAttribute('data-current-action', '');
          console.log(`âœ… ì²œì°½ ${side}: ${actionText} ì™„ë£Œ (ìë™ ëª¨ë“œ ë³µê·€)`);
          
        } catch (error) {
          if (error.message === 'Operation cancelled') {
            console.log(`â¸ï¸ ì²œì°½ ${side}: ${actionText} ì¤‘ë‹¨ë¨`);
            return; // ì¤‘ë‹¨ëœ ê²½ìš° ì—ëŸ¬ë¡œ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
          }
          
          console.error(`âŒ ì²œì°½ ${side} ${actionText} ì—ëŸ¬:`, error);
          alert(`âŒ ì²œì°½ ${actionText} ì‹¤íŒ¨: ${error.message}`);
          statusEl.textContent = 'âŒ ì˜¤ë¥˜ ë°œìƒ';
          
          // ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
          footer.innerHTML = `
            <button class="skylight-btn open-btn" 
                    data-auto="${autoMode}"
                    data-open="${openMode}"
                    data-close="${closeMode}"
                    onclick="operateSkylight(this, '${side}', 'open')" 
                    style="flex: 1; padding: 8px; border: 1px solid #4ecca3; background: transparent; color: #4ecca3; border-radius: 4px; cursor: pointer; font-size: 14px;">
              ğŸ”¼ ì—´ê¸°
            </button>
            <button class="skylight-btn close-btn" 
                    data-auto="${autoMode}"
                    data-open="${openMode}"
                    data-close="${closeMode}"
                    onclick="operateSkylight(this, '${side}', 'close')" 
                    style="flex: 1; padding: 8px; border: 1px solid #ff6b6b; background: transparent; color: #ff6b6b; border-radius: 4px; cursor: pointer; font-size: 14px;">
              ğŸ”½ ë‹«ê¸°
            </button>
          `;
          
          card.setAttribute('data-current-action', '');
        }
      }
      
      // ğŸ›‘ ì²œì°½ ì¤‘ë‹¨ (ìˆ˜ë™ ì¤‘ë‹¨)
      async function stopSkylight(btnEl, side) {
        const card = btnEl.closest('.control-card');
        const statusEl = card.querySelector('.skylight-status');
        const chipEl = card.querySelector('.chip');
        const footer = card.querySelector('footer');
        
        const autoMode = btnEl.getAttribute('data-auto');
        const openMode = btnEl.getAttribute('data-open');
        const closeMode = btnEl.getAttribute('data-close');
        
        const currentAction = card.getAttribute('data-current-action');
        
        if (!currentAction || currentAction === '') {
          console.warn(`âš ï¸ ì²œì°½ ${side}: ì‘ë™ ì¤‘ì´ ì•„ë‹˜`);
          return;
        }
        
        try {
          console.log(`â¸ï¸ ì²œì°½ ${side}: ìˆ˜ë™ ì¤‘ë‹¨ ì‹œì‘`);
          
          // íƒ€ì´ë¨¸ ì·¨ì†Œ
          if (skylightTimers[side].intervalId) {
            clearInterval(skylightTimers[side].intervalId);
            skylightTimers[side].intervalId = null;
          }
          if (skylightTimers[side].timeoutId) {
            clearTimeout(skylightTimers[side].timeoutId);
            skylightTimers[side].timeoutId = null;
          }
          skylightTimers[side].cancelFlag = true;
          
          // í˜„ì¬ ëª¨ë“œ OFF
          const currentMode = currentAction === 'open' ? openMode : closeMode;
          await fetch(`${API_SERVER}/api/settings/${currentMode}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ value: 0 })
          });
          
          // ì˜¤í† ëª¨ë“œ ON
          await fetch(`${API_SERVER}/api/settings/${autoMode}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ value: 1 })
          });
          
          // UI ì—…ë°ì´íŠ¸
          statusEl.textContent = 'ìë™ ì œì–´';
          chipEl.textContent = 'ìë™';
          chipEl.classList.remove('manual');
          chipEl.classList.add('auto');
          
          // ë²„íŠ¼ ì›ë˜ëŒ€ë¡œ ë³µêµ¬
          footer.innerHTML = `
            <button class="skylight-btn open-btn" 
                    data-auto="${autoMode}"
                    data-open="${openMode}"
                    data-close="${closeMode}"
                    onclick="operateSkylight(this, '${side}', 'open')" 
                    style="flex: 1; padding: 8px; border: 1px solid #4ecca3; background: transparent; color: #4ecca3; border-radius: 4px; cursor: pointer; font-size: 14px;">
              ğŸ”¼ ì—´ê¸°
            </button>
            <button class="skylight-btn close-btn" 
                    data-auto="${autoMode}"
                    data-open="${openMode}"
                    data-close="${closeMode}"
                    onclick="operateSkylight(this, '${side}', 'close')" 
                    style="flex: 1; padding: 8px; border: 1px solid #ff6b6b; background: transparent; color: #ff6b6b; border-radius: 4px; cursor: pointer; font-size: 14px;">
              ğŸ”½ ë‹«ê¸°
            </button>
          `;
          
          card.setAttribute('data-current-action', '');
          console.log(`âœ… ì²œì°½ ${side}: ì¤‘ë‹¨ ì™„ë£Œ (ìë™ ëª¨ë“œ ë³µê·€)`);
          
        } catch (error) {
          console.error(`âŒ ì²œì°½ ${side} ì¤‘ë‹¨ ì—ëŸ¬:`, error);
          alert(`âŒ ì²œì°½ ì¤‘ë‹¨ ì‹¤íŒ¨: ${error.message}`);
        }
      }
    </script>
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar">
        <button class="sidebar-toggle" id="sidebarToggle" aria-label="ì‚¬ì´ë“œë°” í† ê¸€">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <div class="brand"><span>ğŸŒ±</span>AISEED FARM ONE</div>
        <nav>
          <ul>
            <li class="active"><a href="index.html"><div class="icon">ğŸ“Š</div><span>ë°ì‹œë³´ë“œ</span></a></li>
            <li><a href="sensor-monitor.html"><div class="icon">ğŸ›°ï¸</div><span>ì„¼ì„œ ëª¨ë‹ˆí„°</span></a></li>
            <li><a href="monitoring.html"><div class="icon">ğŸ“¹</div><span>ëª¨ë‹ˆí„°ë§</span></a></li>
            <li><a href="control-schedule.html"><div class="icon">ğŸ§­</div><span>ì œì–´ ìŠ¤ì¼€ì¤„</span></a></li>
            <li><a href="notifications.html"><div class="icon">ğŸ””</div><span>ì•Œë¦¼ ì„¼í„°</span></a></li>
            <li><a href="reports.html"><div class="icon">ğŸ—‚ï¸</div><span>ë¦¬í¬íŠ¸ & ë¡œê·¸</span></a></li>
          </ul>
        </nav>
        <div class="sidebar-footer">
          ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘ <strong>ON</strong><br />
          ìµœê·¼ ì—…ë°ì´íŠ¸: ì˜¤ëŠ˜ ì˜¤í›„ 08:51
        </div>
      </aside>

      <div class="workspace">
        <header class="topbar">
          <div>
            <h1>ìŠ¤ë§ˆíŠ¸íŒœ ë°ì‹œë³´ë“œ</h1>
            <p id="current-date-info">-- Â· ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ Â· ë‚˜ì£¼ ëŒ€ì‹¤ë§ˆì„ ì˜¨ì‹¤ Aë™</p>
          </div>
        </header>

        <main class="content">
          <section class="hero-grid">
            <article class="card status-card">
              <div class="status-main">
                <h3>ë‚˜ì£¼ ëŒ€ì‹¤ë§ˆì„ ì˜¨ì‹¤ Â· ìš´ì˜ì¤‘</h3>
                <div class="meta">
                  ì „ë¼ë‚¨ë„ ë‚˜ì£¼ì‹œ Â· <span id="weather-status">--</span> Â· <span id="feels-like-temp">--</span>â„ƒ<br />
                  ë§ˆì§€ë§‰ ì ê²€: <span id="last-check">--</span> Â· ë‹´ë‹¹ì: <span id="manager">--</span>
                </div>
                <div class="tags">
                  <span class="tag">ë‚´ì¼ ì˜ˆìƒ: <span id="forecast">--</span></span>
                  <span class="tag">ì‹œìŠ¤í…œ ìƒíƒœ: <span id="system-status">--</span></span>
                  <span class="tag">ê´€ìˆ˜ ìŠ¤ì¼€ì¤„: <span id="irrigation-schedule">--</span></span>
                </div>
              </div>
              <div class="status-side">
                <div class="mini-card">
                  <div>
                    <strong>ì—ë„ˆì§€ ì‚¬ìš©ëŸ‰</strong>
                    <span><span id="energy-today">--</span> kWh Â· ì–´ì œ ëŒ€ë¹„ <span id="energy-diff">--</span></span>
                  </div>
                  <div class="chip"><span id="energy-mode">--</span></div>
                </div>
                <div class="mini-card">
                  <div>
                    <strong>ê´€ì¸¡ ì¥ë¹„</strong>
                    <span><span id="sensor-count">--</span>ê°œ ì„¼ì„œ ì—°ê²° Â· ì˜¤ë¥˜ <span id="sensor-errors">--</span>ê±´</span>
                  </div>
                  <div class="chip">Live</div>
                </div>
              </div>
              <!-- ê°€ì‹ì  ë°ì´í„° ì£¼ì„ (ë‚˜ì¤‘ì— APIë¡œ ë§¤í•‘ ì˜ˆì •)
              ì „ë¼ë‚¨ë„ ë‚˜ì£¼ì‹œ Â· ğŸŒ¤ ë§‘ìŒ Â· ì²´ê° 21â„ƒ
              ë§ˆì§€ë§‰ ì ê²€ 08:51 Â· ë‹´ë‹¹ì ê¹€í˜„ìˆ˜
              ë‚´ì¼ ì˜ˆìƒ: êµ¬ë¦„ ë§ìŒ Â· 20â„ƒ
              ì‹œìŠ¤í…œ ìƒíƒœ ì •ìƒ
              ê´€ìˆ˜ ìŠ¤ì¼€ì¤„ D-1
              ê¸ˆì¼ 48.2 kWh Â· ì–´ì œ ëŒ€ë¹„ 7% ì ˆê°
              17ê°œ ì„¼ì„œ ì—°ê²° Â· ì˜¤ë¥˜ 0ê±´
              Eco ëª¨ë“œ
              -->
            </article>
            <article class="card">
              <h2>ì‘ì—… ìº˜ë¦°ë”</h2>
              <ul style="margin: 0; padding: 0; list-style: none; display: grid; gap: 14px; font-size: 13px; color: var(--text-soft);" id="work-calendar-list">
                <li><strong style="color: var(--text-strong);">--</strong> ì‘ì—… ì •ë³´ ì—†ìŒ</li>
              </ul>
              <!-- ê°€ì‹ì  ë°ì´í„° ì£¼ì„
              <li><strong style="color: var(--text-strong);">D-1</strong> ê´€ìˆ˜ ë¼ì¸ í•„í„° ì„¸ì²™ Â· ë‹´ë‹¹ì ë°•ìœ ì§„</li>
              <li><strong style="color: var(--text-strong);">D-3</strong> ì˜¨ì‹¤ ë‚´ë¶€ ì ê²€ Â· ì£¼ê¸° 7ì¼ Â· ì™„ë£Œìœ¨ 60%</li>
              <li><strong style="color: var(--text-strong);">D-5</strong> ì–‘ì•¡ ë°°í•© êµì²´ Â· ìë™ ì˜ˆì•½</li>
              -->
            </article>
            <article class="card">
              <h2>ì¬ë°° í™˜ê²½ ëª©í‘œ</h2>
              <div style="display: grid; gap: 12px; font-size: 13px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">ë‚´ë¶€ ì˜¨ë„ <span style="color: var(--text-strong);"><span id="target-temp">--</span>â„ƒ Â±<span id="target-temp-tolerance">--</span></span></div>
                <div style="display:flex; justify-content:space-between; align-items:center;">ë‚´ë¶€ ìŠµë„ <span style="color: var(--text-strong);"><span id="target-humidity">--</span>% Â±<span id="target-humidity-tolerance">--</span></span></div>
                <div style="display:flex; justify-content:space-between; align-items:center;">ì¼ì‚¬ëŸ‰ <span style="color: var(--text-strong);"><span id="target-solar">--</span> W/ã¡</span></div>
                <div style="display:flex; justify-content:space-between; align-items:center;">í† ì–‘ í•¨ìˆ˜ìœ¨ <span style="color: var(--text-strong);"><span id="target-soil-moisture">--</span>% Â· í•˜í•œ <span id="target-soil-moisture-min">--</span>%</span></div>
              </div>
              <!-- ê°€ì‹ì  ë°ì´í„° ì£¼ì„
              ë‚´ë¶€ ì˜¨ë„: 23â„ƒ Â±1.5
              ë‚´ë¶€ ìŠµë„: 68% Â±5
              ì¼ì‚¬ëŸ‰: 450 W/ã¡
              í† ì–‘ í•¨ìˆ˜ìœ¨: 38% Â· í•˜í•œ 32%
              -->
            </article>
          </section>

          <section>
            <div class="section-heading">
              <h2>ì‹¤ì‹œê°„ ì„¼ì„œ ë°ì´í„° Â· ë‚´ë¶€ ì„¼ì„œ</h2>
              <span>ìµœê·¼ ê°±ì‹ : <span id="last-update-time">--</span> Â· ì •ìƒ: <span id="normal-count">--</span> Â· ì£¼ì˜: <span id="warning-count">--</span></span>
            </div>
            <div class="sensor-grid">
              <article class="sensor-card" data-state="normal" data-sensor="indoor_temp">
                <header>
                  <div class="emoji">ğŸŒ¡ï¸</div>
                  <div>
                    <h3>ë‚´ë¶€ ì˜¨ë„</h3>
                    <small style="color: var(--text-soft);">ì„¼ì„œ ID Â· INT-TEMP-01</small>
                  </div>
                </header>
                <div class="value">-- â„ƒ</div>
                <span class="status-chip">--</span>
                <footer>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ Â· --</footer>
              </article>

              <article class="sensor-card" data-state="normal" data-sensor="indoor_humidity">
                <header>
                  <div class="emoji">ğŸ’§</div>
                  <div>
                    <h3>ë‚´ë¶€ ìŠµë„</h3>
                    <small style="color: var(--text-soft);">ì„¼ì„œ ID Â· INT-HUM-01</small>
                  </div>
                </header>
                <div class="value">-- %</div>
                <span class="status-chip">--</span>
                <footer>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ Â· --</footer>
              </article>

              <article class="sensor-card" data-state="normal" data-sensor="indoor_solar">
                <header>
                  <div class="emoji">ğŸ”†</div>
                  <div>
                    <h3>ì‹¤ë‚´ ì¼ì‚¬ëŸ‰</h3>
                    <small style="color: var(--text-soft);">ì„¼ì„œ ID Â· INT-SOLAR-02</small>
                  </div>
                </header>
                <div class="value">-- W/ã¡</div>
                <span class="status-chip">--</span>
                <footer>ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ Â· --</footer>
              </article>

              <article class="sensor-card" data-state="warning" data-sensor="indoor_moisture">
                <header>
                  <div class="emoji">ğŸŒ±</div>
                  <div>
                    <h3>í† ì–‘ ìˆ˜ë¶„ í•¨ìˆ˜ìœ¨</h3>
                    <small style="color: var(--text-soft);">ì„¼ì„œ ID Â· SOIL-MOIST-05</small>
                  </div>
                </header>
                <div class="value">-- %</div>
                <span class="status-chip">--</span>
                <footer>ê´€ìˆ˜ ìŠ¤ì¼€ì¤„ Â· <span id="irrigation-adjust">--</span></footer>
              </article>

              <article class="sensor-card" data-state="normal" data-sensor="indoor_soil_tension">
                <header>
                  <div class="emoji">ğŸ§ª</div>
                  <div>
                    <h3>í† ì–‘ ìˆ˜ë¶„ ì¥ë ¥</h3>
                    <small style="color: var(--text-soft);">ì„¼ì„œ ID Â· SOIL-TENSION-02</small>
                  </div>
                </header>
                <div class="value">-- kPa</div>
                <span class="status-chip">--</span>
                <footer>ì„ê³„ì¹˜: <span id="soil-tension-threshold">--</span> kPa Â· <span id="soil-tension-action">--</span></footer>
              </article>
              <!-- ê°€ì‹ì  ë°ì´í„° ì£¼ì„
              ì •ìƒ ë²”ìœ„, ì•ˆì • ìœ ì§€, ëª©í‘œ ë‹¬ì„±, ì–‘í˜¸
              ì£¼ì˜ Â· ëª©í‘œ ìƒíšŒ
              ê´€ìˆ˜ ìŠ¤ì¼€ì¤„ Â· 2ì‹œê°„ í›„ ìë™ ì¡°ì •
              ì„ê³„ì¹˜: 35 kPa Â· ì¡°ì¹˜ ì—†ìŒ
              -->
            </div>
          </section>

          <section>
            <div class="section-heading">
              <h2>ì™¸ë¶€ ì„¼ì„œ ìš”ì•½</h2>
              <span>ë©”ì¸ í•˜ìš°ìŠ¤ ì£¼ë³€ ê´€ì¸¡</span>
            </div>
            <div class="outer-sensors">
              <div class="item" data-sensor="outdoor_temp">
                <span class="label">ì™¸ë¶€ ì˜¨ë„</span>
                <span class="value">-- â„ƒ</span>
                <small style="color: var(--text-soft);">ì–´ì œ ëŒ€ë¹„ --</small>
              </div>
              <div class="item" data-sensor="outdoor_humidity">
                <span class="label">ì™¸ë¶€ ìŠµë„</span>
                <span class="value">-- %</span>
                <small style="color: var(--text-soft);">ëª©í‘œ: <span id="target-outdoor-humidity">--</span></small>
              </div>
              <div class="item" data-sensor="outdoor_solar">
                <span class="label">ì™¸ë¶€ ì¼ì‚¬ëŸ‰</span>
                <span class="value">-- W/ã¡</span>
                <small style="color: var(--text-soft);">ìì—°ê´‘ ì¶©ë¶„</small>
              </div>
              <div class="item">
                <span class="label">ì™¸ë¶€ í’í–¥ Â· í’ì†</span>
                <span class="value"><span data-sensor="outdoor_wind_dir">--</span>Â° Â· <span data-sensor="outdoor_wind_speed">--</span> m/s</span>
                <small style="color: var(--text-soft);">ë‚¨ì„œí’ Â· ì•ˆì •</small>
              </div>
              <div class="item">
                <span class="label">ê°ìš°(ë¹„ ê°ì§€)</span>
                <span class="value">OFF</span>
                <small style="color: var(--text-soft);">ìµœê·¼ ê°•ìš° ì—†ìŒ</small>
              </div>
            </div>
          </section>

          <section>
            <div class="section-heading">
              <h2>ì œì–´ ì¥ì¹˜ ìƒíƒœ</h2>
              <span>ìë™ ì œì–´ ë¹„ìœ¨: <span id="auto-control-ratio">--</span>% Â· ì›ê²© ì œì–´ ê°€ëŠ¥</span>
            </div>
            <div class="control-grid">
              <article class="control-card" data-device="ê´€ìˆ˜" data-control="irrigation">
                <header>
                  <div class="title">
                    <strong>ê´€ìˆ˜</strong>
                    <span>ìë™ ì œì–´</span>
                  </div>
                  <div class="toggle off" data-mode="ìë™" 
                       data-auto="irrigation_auto_mode" 
                       data-forced="irrigation_forced_operation"
                       onclick="toggleControl(this, 'ê´€ìˆ˜')"></div>
                </header>
                <div class="chip auto">ìë™</div>
                <footer>
                  <span>ìŠ¤ì¼€ì¤„ ëŒ€ê¸° ì¤‘</span>
                  <span style="color: var(--text-soft);" class="status-text">OFF</span>
                </footer>
              </article>

              <article class="control-card" data-device="ë‚œë°©" data-control="heating">
                <header>
                  <div class="title">
                    <strong>ë‚œë°©</strong>
                    <span>ìë™ ì œì–´</span>
                  </div>
                  <div class="toggle off" data-mode="ìë™" 
                       data-auto="heating_auto_mode" 
                       data-forced="heating_forced_operation"
                       onclick="toggleControl(this, 'ë‚œë°©')"></div>
                </header>
                <div class="chip auto">ìë™</div>
                <footer>
                  <span>ì˜¨ë„ ëª¨ë‹ˆí„°ë§ ì¤‘</span>
                  <span style="color: var(--text-soft);" class="status-text">OFF</span>
                </footer>
              </article>

              <article class="control-card" data-device="ìœ ë™íŒ¬" data-control="circulation_fan">
                <header>
                  <div class="title">
                    <strong>ìœ ë™íŒ¬</strong>
                    <span>ìë™ ì œì–´</span>
                  </div>
                  <div class="toggle off" data-mode="ìë™" 
                       data-auto="circulation_fan_auto_mode" 
                       data-forced="circulation_fan_forced_operation"
                       onclick="toggleControl(this, 'ìœ ë™íŒ¬')"></div>
                </header>
                <div class="chip auto">ìë™</div>
                <footer>
                  <span>ì˜¨ë„ ê· ì¼í™” ì¤‘</span>
                  <span style="color: var(--text-soft);" class="status-text">OFF</span>
                </footer>
              </article>

              <article class="control-card" data-device="ì œìŠµê¸°" data-control="dehumidifier">
                <header>
                  <div class="title">
                    <strong>ì œìŠµê¸°</strong>
                    <span>ìë™ ì œì–´</span>
                  </div>
                  <div class="toggle off" data-mode="ìë™" 
                       data-auto="dehumidifier_auto_mode" 
                       data-forced="dehumidifier_forced_operation"
                       onclick="toggleControl(this, 'ì œìŠµê¸°')"></div>
                </header>
                <div class="chip auto">ìë™</div>
                <footer>
                  <span>ìŠµë„ ëª¨ë‹ˆí„°ë§ ì¤‘</span>
                  <span style="color: var(--text-soft);" class="status-text">OFF</span>
                </footer>
              </article>

              <article class="control-card" data-device="LEDì¡°ëª…" data-control="lighting">
                <header>
                  <div class="title">
                    <strong>LEDì¡°ëª…</strong>
                    <span>ìë™ ì œì–´</span>
                  </div>
                  <div class="toggle off" data-mode="ìë™" 
                       data-auto="lighting_auto_mode" 
                       data-forced="lighting_forced_operation"
                       onclick="toggleControl(this, 'LEDì¡°ëª…')"></div>
                </header>
                <div class="chip auto">ìë™</div>
                <footer>
                  <span>ì¡°ë„ ëª¨ë‹ˆí„°ë§ ì¤‘</span>
                  <span style="color: var(--text-soft);" class="status-text">OFF</span>
                </footer>
              </article>
              <!-- ê°€ì‹ì  ë°ì´í„° ì£¼ì„ (ë‚˜ì¤‘ì— ì œì–´ APIë¡œ ë§¤í•‘ ì˜ˆì •)
              ë§ˆì§€ë§‰ ì‘ë™ 08:20 Â· ìë™ ëª¨ë“œ
              ë‹¤ìŒ ì˜ˆì•½: ì˜¤ëŠ˜ 12:30
              ë§ˆì§€ë§‰ ì‘ë™ 07:29 Â· ìˆ˜ë™ ëª¨ë“œ
              ê¶Œì¥ ì˜¨ë„ ë„ë‹¬
              í˜„ì¬ ì†ë„ 45% Â· ì˜¨ë„ ê· ì¼í™”
              ë‚´ë¶€ ì˜¨ë„ í¸ì°¨ 1.1â„ƒ
              ë§ˆì§€ë§‰ ì‘ë™ 08:21 Â· ìë™ ëª¨ë“œ
              ìŠµë„ 68% Â· ì •ìƒ ë²”ìœ„
              ë³´ì • ëª¨ë“œ Â· ì¼ì‚¬ ë³´ì¡°
              ë°ê¸° 70% Â· ìì • ìë™ ì¢…ë£Œ
              -->

              <article class="control-card" data-device="ì²œì°½ì¢Œì¸¡" data-control="left_skylight" data-current-action="">
                <header>
                  <div class="title">
                    <strong>ì²œì°½ ì¢Œì¸¡</strong>
                    <span class="skylight-status">ìë™ ì œì–´</span>
                  </div>
                </header>
                <div class="chip auto">ìë™</div>
                <footer style="display: flex; gap: 8px; justify-content: center;">
                  <button class="skylight-btn open-btn" 
                          data-auto="left_auto_mode"
                          data-open="left_open_mode"
                          data-close="left_close_mode"
                          onclick="operateSkylight(this, 'ì¢Œì¸¡', 'open')" 
                          style="flex: 1; padding: 8px; border: 1px solid #4ecca3; background: transparent; color: #4ecca3; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”¼ ì—´ê¸°
                  </button>
                  <button class="skylight-btn close-btn" 
                          data-auto="left_auto_mode"
                          data-open="left_open_mode"
                          data-close="left_close_mode"
                          onclick="operateSkylight(this, 'ì¢Œì¸¡', 'close')" 
                          style="flex: 1; padding: 8px; border: 1px solid #ff6b6b; background: transparent; color: #ff6b6b; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”½ ë‹«ê¸°
                  </button>
                </footer>
              </article>

              <article class="control-card" data-device="ì²œì°½ìš°ì¸¡" data-control="right_skylight" data-current-action="">
                <header>
                  <div class="title">
                    <strong>ì²œì°½ ìš°ì¸¡</strong>
                    <span class="skylight-status">ìë™ ì œì–´</span>
                  </div>
                </header>
                <div class="chip auto">ìë™</div>
                <footer style="display: flex; gap: 8px; justify-content: center;">
                  <button class="skylight-btn open-btn" 
                          data-auto="right_auto_mode"
                          data-open="right_open_mode"
                          data-close="right_close_mode"
                          onclick="operateSkylight(this, 'ìš°ì¸¡', 'open')" 
                          style="flex: 1; padding: 8px; border: 1px solid #4ecca3; background: transparent; color: #4ecca3; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”¼ ì—´ê¸°
                  </button>
                  <button class="skylight-btn close-btn" 
                          data-auto="right_auto_mode"
                          data-open="right_open_mode"
                          data-close="right_close_mode"
                          onclick="operateSkylight(this, 'ìš°ì¸¡', 'close')" 
                          style="flex: 1; padding: 8px; border: 1px solid #ff6b6b; background: transparent; color: #ff6b6b; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”½ ë‹«ê¸°
                  </button>
                </footer>
              </article>

              <article class="control-card" data-device="ì²œì¥ë³´ì˜¨ì»¤íŠ¼" data-control="upper_insulation" data-current-action="">
                <header>
                  <div class="title">
                    <strong>ì²œì¥ ë³´ì˜¨ì»¤íŠ¼</strong>
                    <span class="skylight-status">ìë™ ì œì–´</span>
                  </div>
                </header>
                <div class="chip auto">ìë™</div>
                <footer style="display: flex; gap: 8px; justify-content: center;">
                  <button class="skylight-btn open-btn" 
                          data-auto="upper_insulation_curtain_auto_mode"
                          data-open="upper_insulation_curtain_open_mode"
                          data-close="upper_insulation_curtain_close_mode"
                          onclick="operateSkylight(this, 'ì²œì¥ë³´ì˜¨', 'open')" 
                          style="flex: 1; padding: 8px; border: 1px solid #4ecca3; background: transparent; color: #4ecca3; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”¼ ì—´ê¸°
                  </button>
                  <button class="skylight-btn close-btn" 
                          data-auto="upper_insulation_curtain_auto_mode"
                          data-open="upper_insulation_curtain_open_mode"
                          data-close="upper_insulation_curtain_close_mode"
                          onclick="operateSkylight(this, 'ì²œì¥ë³´ì˜¨', 'close')" 
                          style="flex: 1; padding: 8px; border: 1px solid #ff6b6b; background: transparent; color: #ff6b6b; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”½ ë‹«ê¸°
                  </button>
                </footer>
              </article>

              <article class="control-card" data-device="ì¸¡ë©´ë³´ì˜¨ì»¤íŠ¼" data-control="side_insulation" data-current-action="">
                <header>
                  <div class="title">
                    <strong>ì¸¡ë©´ ë³´ì˜¨ì»¤íŠ¼</strong>
                    <span class="skylight-status">ìë™ ì œì–´</span>
                  </div>
                </header>
                <div class="chip auto">ìë™</div>
                <footer style="display: flex; gap: 8px; justify-content: center;">
                  <button class="skylight-btn open-btn" 
                          data-auto="side_insulation_curtain_auto_mode"
                          data-open="side_insulation_curtain_open_mode"
                          data-close="side_insulation_curtain_close_mode"
                          onclick="operateSkylight(this, 'ì¸¡ë©´ë³´ì˜¨', 'open')" 
                          style="flex: 1; padding: 8px; border: 1px solid #4ecca3; background: transparent; color: #4ecca3; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”¼ ì—´ê¸°
                  </button>
                  <button class="skylight-btn close-btn" 
                          data-auto="side_insulation_curtain_auto_mode"
                          data-open="side_insulation_curtain_open_mode"
                          data-close="side_insulation_curtain_close_mode"
                          onclick="operateSkylight(this, 'ì¸¡ë©´ë³´ì˜¨', 'close')" 
                          style="flex: 1; padding: 8px; border: 1px solid #ff6b6b; background: transparent; color: #ff6b6b; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”½ ë‹«ê¸°
                  </button>
                </footer>
              </article>

              <article class="control-card" data-device="ì²œì¥ì°¨ê´‘ì»¤íŠ¼" data-control="shading_curtain" data-current-action="">
                <header>
                  <div class="title">
                    <strong>ì²œì¥ ì°¨ê´‘ì»¤íŠ¼</strong>
                    <span class="skylight-status">ìë™ ì œì–´</span>
                  </div>
                </header>
                <div class="chip auto">ìë™</div>
                <footer style="display: flex; gap: 8px; justify-content: center;">
                  <button class="skylight-btn open-btn" 
                          data-auto="shading_curtain_auto_mode"
                          data-open="shading_curtain_open_mode"
                          data-close="shading_curtain_close_mode"
                          onclick="operateSkylight(this, 'ì°¨ê´‘', 'open')" 
                          style="flex: 1; padding: 8px; border: 1px solid #4ecca3; background: transparent; color: #4ecca3; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”¼ ì—´ê¸°
                  </button>
                  <button class="skylight-btn close-btn" 
                          data-auto="shading_curtain_auto_mode"
                          data-open="shading_curtain_open_mode"
                          data-close="shading_curtain_close_mode"
                          onclick="operateSkylight(this, 'ì°¨ê´‘', 'close')" 
                          style="flex: 1; padding: 8px; border: 1px solid #ff6b6b; background: transparent; color: #ff6b6b; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    ğŸ”½ ë‹«ê¸°
                  </button>
                </footer>
              </article>
              <!-- ê°€ì‹ì  ë°ì´í„° ì£¼ì„
              ë§ˆì§€ë§‰ ì‘ë™ 08:15 Â· ìë™ ëª¨ë“œ
              ë†ì¥ ìƒíƒœ ì •ìƒ
              ë§ˆì§€ë§‰ ì‘ë™ 07:50 Â· ìë™ ëª¨ë“œ
              ì»¤íŠ¼ ë‹«í˜ ìƒíƒœ
              ë§ˆì§€ë§‰ ì‘ë™ 08:10 Â· ìë™ ëª¨ë“œ
              ì˜¨ë„ 25â„ƒ ìœ ì§€ ì¤‘
              ì˜¨ë„ ì¡°ì ˆ ì™„ë£Œ
              ë§ˆì§€ë§‰ ì‘ë™ 07:45 Â· ìë™ ëª¨ë“œ
              ì¸¡ë©´ í™˜ê¸° ì •ìƒ
              ì¸¡ë©´ ë‹¨ì—´ ì™„ë£Œ
              ë§ˆì§€ë§‰ ì‘ë™ 06:30 Â· ìë™ ëª¨ë“œ
              ì¼ì‚¬ëŸ‰ ì •ìƒ ë²”ìœ„
              ì°¨ê´‘ íš¨ê³¼ ìœ ì§€
              -->
            </div>
          </section>

          <div class="dashboard-bottom">
            <article class="chart-card">
              <div class="chart-header">
                <h3>í™˜ê²½ ì§€í‘œ ì¶”ì„¸ (24ì‹œê°„)</h3>
                <div class="tabs">
                  <span class="active">ì˜¨ë„</span>
                  <span>ìŠµë„</span>
                  <span>ì¼ì‚¬ëŸ‰</span>
                  <span>í† ì–‘</span>
                </div>
              </div>
              <div class="chart-placeholder" style="position: relative; height: 300px;">
                <canvas id="envChart"></canvas>
              </div>
              <div class="chart-legend">
                <span><span class="dot"></span>ë‚´ë¶€ ì„¼ì„œ</span>
                <span><span class="dot alt"></span>ì™¸ë¶€ ì„¼ì„œ</span>
                <span><span class="dot alert"></span>ì£¼ì˜ êµ¬ê°„</span>
              </div>
            </article>

            <aside class="ai-panel">
              <header>
                <h3>AI ì œì–´ ì œì•ˆ</h3>
                <span class="badge">Smart Advisor</span>
              </header>
              <div id="ai-suggestions-list">
                <article class="ai-item">
                  <p style="color: var(--text-soft);">AI ì œì•ˆì´ ì—†ìŠµë‹ˆë‹¤</p>
                </article>
              </div>
              <!-- ê°€ì‹ì  ë°ì´í„° ì£¼ì„ (ë‚˜ì¤‘ì— AI APIë¡œ ë§¤í•‘ ì˜ˆì •)
              <article class="ai-item">
                <strong>ê´€ìˆ˜ëŸ‰ ì¡°ì • ì¶”ì²œ</strong>
                <p>í† ì–‘ ìˆ˜ë¶„ í•¨ìˆ˜ìœ¨ì´ ëª©í‘œ ìƒí•œì„ ê²½ë¯¸í•˜ê²Œ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤. ê´€ìˆ˜ëŸ‰ì„ 12% ì¤„ì´ê³ , ë‹¤ìŒ ì‚¬ì´í´ì„ ìë™ìœ¼ë¡œ ì¬í‰ê°€í•˜ì„¸ìš”.</p>
                <div class="actions">
                  <span>ì¦‰ì‹œ ì ìš©</span>
                  <span>ë‚˜ì¤‘ì—</span>
                </div>
              </article>
              <article class="ai-item">
                <strong>í™˜ê¸° íŒ¨í„´ ìµœì í™”</strong>
                <p>ì™¸ë¶€ í’í–¥Â·í’ì†ì„ ê¸°ë°˜ìœ¼ë¡œ ê°œíì°½ì„ ì¢Œì¸¡ 5% ì¶”ê°€ ê°œë°©í•˜ë©´ ë‚´ë¶€ ì˜¨ë„ í¸ì°¨ë¥¼ 0.4â„ƒ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <div class="actions">
                  <span>ìë™ íŠœë‹</span>
                  <span>ì œì•ˆ ìˆ¨ê¸°ê¸°</span>
                </div>
              </article>
              <article class="ai-item">
                <strong>ì˜ˆë°© ì ê²€ ì•Œë¦¼</strong>
                <p>ìœ ë™ íŒ¬ ë² ì–´ë§ ì§„ë™ ìˆ˜ì¹˜ê°€ í‰ì†Œ ëŒ€ë¹„ 12% ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤. 48ì‹œê°„ ë‚´ ì ê²€ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
                <div class="actions">
                  <span>ì‘ì—… ìƒì„±</span>
                  <span>ë¬´ì‹œ</span>
                </div>
              </article>
              -->
            </aside>
          </div>
        </main>

        <footer>Â© 2025 AISEED FARM ONE Â· ì‹¤ì¦ ì„œë¹„ìŠ¤ ë²„ì „ 0.9.3</footer>
      </div>
    </div>
    <!-- <script src="auth.js"></script> --> <!-- ì¸ì¦ ë¹„í™œì„±í™” -->
    <script src="script.js"></script>
  </body>
</html>
